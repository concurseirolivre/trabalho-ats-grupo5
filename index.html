<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o ATS - Grupo 5</title>
    <style>
        /* --- CONFIGURA√á√ÉO GERAL --- */
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Fundo */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('img1.jpg'); /* Verifique se sua imagem est√° aqui */
            background-size: cover;
            background-position: center;
            filter: brightness(0.3) contrast(1.2) blur(2px);
            z-index: -1;
        }

        /* --- TELA DE INTRODU√á√ÉO (AUDIO) --- */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: opacity 1s ease-out;
        }

        #intro-content h1 {
            color: #d32f2f;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(211, 47, 47, 0.5);
            animation: pulse 2s infinite;
        }

        /* Bot√£o Principal de In√≠cio */
        #btn-start-audio {
            background: transparent;
            border: 2px solid #d32f2f;
            color: #d32f2f;
            padding: 15px 40px;
            font-size: 1.5em;
            font-family: inherit;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
        }
        #btn-start-audio:hover {
            background-color: #d32f2f;
            color: #fff;
            box-shadow: 0 0 20px #d32f2f;
        }

        /* Mensagem de Status */
        #status-msg {
            margin-top: 20px;
            color: #888;
            font-size: 1.2em;
            min-height: 1.5em;
        }

        /* Bot√£o de Emerg√™ncia (Pular) */
        #btn-skip {
            margin-top: 50px;
            background: none;
            border: none;
            color: #555;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9em;
        }

        /* --- O JOGO --- */
        #game-container {
            width: 80%;
            max-width: 800px;
            background-color: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-left: 5px solid #d32f2f;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            min-height: 400px;
            display: none; 
            flex-direction: column;
            justify-content: space-between;
            opacity: 0;
        }

        .header {
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #888;
        }
        .status-blink { color: #d32f2f; font-weight: bold; animation: blink 1s infinite; }
        #story-text { font-size: 1.2em; line-height: 1.6; white-space: pre-wrap; min-height: 150px; }
        #feedback-area { margin: 20px 0; font-weight: bold; padding: 10px; border-radius: 4px; display: none; }
        .feedback-success { background-color: rgba(46, 125, 50, 0.2); border: 1px solid #2e7d32; color: #81c784; }
        .feedback-error { background-color: rgba(198, 40, 40, 0.2); border: 1px solid #c62828; color: #e57373; }
        .choices { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; opacity: 0; transition: opacity 1s; }
        .btn { background: transparent; border: 1px dashed #FFEB3B; color: #FFEB3B; padding: 15px; text-align: left; font-family: inherit; font-size: 1.1em; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background-color: #FFEB3B; color: #000; border-style: solid; transform: translateX(5px); }
        .cursor { display: inline-block; width: 10px; height: 1em; background-color: #0f0; animation: blink 1s infinite; vertical-align: bottom; }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="background"></div>

    <div id="intro-overlay">
        <div id="intro-content">
            <h1>PLANT√ÉO URGENTE</h1>
            <p>Simula√ß√£o de Desastre Ambiental - Grupo 5</p>
            
            <button id="btn-start-audio">INICIAR TRANSMISS√ÉO</button>
            <div id="status-msg"></div>

            <button id="btn-skip" onclick="startGame(true)">[Pular intro e ir para o jogo]</button>
        </div>
    </div>

    <audio id="narracao" src="audio.mp3" preload="auto"></audio>

    <div id="game-container">
        <div class="header">
            <span>SALA DE SITUA√á√ÉO: GRUPO 5</span>
            <span class="status-blink">‚óè AO VIVO - PETR√ìPOLIS</span>
        </div>
        <div id="text-container">
            <span id="story-text"></span><span class="cursor"></span>
        </div>
        <div id="feedback-area"></div>
        <div id="choices-container" class="choices"></div>
    </div>

<script>
    // --- CONTROLE DE √ÅUDIO E ERROS ---
    const introOverlay = document.getElementById('intro-overlay');
    const btnStartAudio = document.getElementById('btn-start-audio');
    const statusMsg = document.getElementById('status-msg');
    const audioPlayer = document.getElementById('narracao');
    const gameContainer = document.getElementById('game-container');

    btnStartAudio.addEventListener('click', function() {
        statusMsg.innerText = "Carregando √°udio...";
        statusMsg.style.color = "#FFEB3B";

        // Tenta tocar
        const playPromise = audioPlayer.play();

        if (playPromise !== undefined) {
            playPromise.then(_ => {
                // Sucesso: √Åudio tocando
                btnStartAudio.style.display = 'none';
                document.getElementById('btn-skip').style.display = 'none';
                statusMsg.innerText = "üì° Reproduzindo transmiss√£o...";
                statusMsg.style.color = "#4CAF50";
            })
            .catch(error => {
                // Erro: Arquivo n√£o encontrado ou bloqueado
                console.error("Erro no √°udio:", error);
                alert("ERRO: N√£o foi poss√≠vel tocar o √°udio 'audio.mp3'.\n\nMotivo: O arquivo pode n√£o estar na pasta ou o nome est√° errado.\n\nIniciando o jogo sem √°udio...");
                startGame(true); // For√ßa o in√≠cio imediato
            });
        }
    });

    // Quando o √°udio acabar, come√ßa o jogo
    audioPlayer.addEventListener('ended', function() {
        startGame(false);
    });

    // Se der erro no carregamento do arquivo (ex: nome errado)
    audioPlayer.addEventListener('error', function(e) {
        console.log("Arquivo de √°udio n√£o encontrado.");
    });

    function startGame(forceImmediate) {
        // Se for for√ßado (erro), esconde r√°pido. Se for normal, faz transi√ß√£o suave.
        const delay = forceImmediate ? 0 : 1000;

        introOverlay.style.opacity = '0';
        
        setTimeout(() => {
            introOverlay.style.display = 'none';
            gameContainer.style.display = 'flex';
            
            // Anima√ß√£o de entrada do jogo
            setTimeout(() => {
                gameContainer.style.opacity = '1';
                gameContainer.style.animation = 'fadeIn 1s ease-out';
                goTo('start');
            }, 100);
        }, delay);
    }

    // --- MOTOR DO JOGO (L√≥gica Corrigida e Revisada) ---
    const story = {
        // CENA 1: O IN√çCIO
        "start": {
            text: "[06:05] CONEX√ÉO ESTABELECIDA COM POSTO DE COMANDO...\n\nO deslizamento acabou de acontecer. A rep√≥rter confirmou o caos local. Voc√™ √© o Coordenador M√©dico.\n\nRecursos limitados. Vidas em risco.\n\nSua primeira decis√£o definir√° toda a opera√ß√£o. Qual sua prioridade?",
            choices: [
                { text: "A - Ir pessoalmente para a Zona de Impacto (Triagem)", target: "erro_gestao" },
                { text: "B - Focar na Gest√£o (Posto de Comando)", target: "fase_2" }
            ]
        },

        // ERRO DA CENA 1
        "erro_gestao": {
            text: "Voc√™ chega √† Zona de Impacto. A cena √© ca√≥tica. Voc√™ ajuda na triagem e salva 3 vidas diretamente.\n\nContudo, voc√™ fica 8 horas preso na opera√ß√£o, sem comunica√ß√£o. Ningu√©m coordenou a avalia√ß√£o dos abrigos.",
            feedback: { type: "error", msg: "ERRO DE GEST√ÉO: Ao focar na emerg√™ncia (micro), voc√™ abdicou da gest√£o (macro)." },
            choices: [
                { text: "Reiniciar Simula√ß√£o (Voltar ao In√≠cio)", target: "start" }
            ]
        },

        // CENA 2: RECURSOS (Se acertou a Cena 1)
        "fase_2": {
            text: "Decis√£o correta. Voc√™ permanece no Posto de Comando para ter a vis√£o geral.\n\n[07:00] Chega o balan√ßo de recursos:\n- 10 equipes m√©dicas dispon√≠veis.\n- Emerg√™ncia: M√∫ltiplos feridos na lama.\n- Preven√ß√£o: 200 desalojados em abrigos prec√°rios.\n\nComo voc√™ aloca sua equipe?",
            feedback: { type: "success", msg: "ACERTO: O papel do coordenador √© gerenciar recursos." },
            choices: [
                { text: "A - 100% das equipes para a Zona de Impacto (Foco nos feridos)", target: "erro_prevencao" },
                { text: "B - 70% Emerg√™ncia / 30% Avalia√ß√£o dos Abrigos", target: "fase_3" }
            ]
        },

        // ERRO DA CENA 2
        "erro_prevencao": {
            text: "[18:00] 12 horas se passam.\n\nO atendimento aos feridos foi √≥timo. Mas um r√°dio desesperado chega do Abrigo 1: \"Doutor, surto de v√¥mito e diarreia aqui. Saneamento colapsou.\"",
            feedback: { type: "error", msg: "FALHA NA PREVEN√á√ÉO: Voc√™ ignorou o 'Desafio' do trabalho (preven√ß√£o de agravos secund√°rios)." },
            choices: [
                { text: "Tentar este passo novamente", target: "fase_2" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },

        // CENA 3: SA√öDE P√öBLICA (Se acertou a Cena 2)
        "fase_3": {
            text: "[10:00] A equipe de avalia√ß√£o (30%) retorna com ALERTA VERMELHO:\n\n1. Abrigo Escola: √Ågua parada e lama. Risco IMINENTE de Leptospirose.\n2. Abrigo Gin√°sio: Superlota√ß√£o e tosse. Risco de Surto Respirat√≥rio.\n\nQual sua prioridade de Sa√∫de P√∫blica?",
            feedback: { type: "success", msg: "ACERTO: Dividir a equipe permitiu detectar os riscos antes que virassem surtos." },
            choices: [
                { text: "A - Atacar a Leptospirose (Profilaxia)", target: "erro_clinico" },
                { text: "B - Atacar o Surto Respirat√≥rio (M√°scaras)", target: "erro_clinico" },
                { text: "C - Atacar a Causa Raiz (Articula√ß√£o Intersetorial)", target: "fase_4" }
            ]
        },

        // ERRO DA CENA 3 (Serve para A e B)
        "erro_clinico": {
            text: "Voc√™ envia insumos m√©dicos. Mas a lama continua l√° (Lepto) e a superlota√ß√£o continua l√° (Respirat√≥rio).\n\nVoc√™ est√° tratando o sintoma, n√£o a causa.",
            feedback: { type: "error", msg: "ERRO DE VIS√ÉO: A√ß√£o cl√≠nica sem mudan√ßa de infraestrutura √© in√∫til aqui." },
            choices: [
                { text: "Tentar este passo novamente", target: "fase_3" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },

        // CENA 4: COMUNICA√á√ÉO (Se acertou a Cena 3)
        "fase_4": {
            text: "[11:00] Voc√™ tenta contatar a Defesa Civil para pedir √°gua pot√°vel e reorganiza√ß√£o do espa√ßo.\n\nO r√°dio est√° mudo. \"Dificuldades de comunica√ß√£o\", como previsto no cen√°rio.\n\nO que voc√™ faz?",
            feedback: { type: "success", msg: "ACERTO: Voc√™ identificou que √© um problema de infraestrutura (intersetorial)." },
            choices: [
                { text: "A - Continuar tentando pelos canais oficiais (Protocolo)", target: "erro_burocracia" },
                { text: "B - Ir fisicamente ao QG da Defesa Civil (Pr√≥-atividade)", target: "vitoria" }
            ]
        },

        // ERRO DA CENA 4
        "erro_burocracia": {
            text: "Voc√™ perde 3 horas tentando usar o r√°dio. Ningu√©m responde. A janela de oportunidade se fecha e os primeiros casos de febre aparecem.",
            feedback: { type: "error", msg: "FALHA DE ARTICULA√á√ÉO: Em desastres, a burocracia colapsa. Esperar √© uma decis√£o errada." },
            choices: [
                { text: "Tentar este passo novamente", target: "fase_4" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },

        // TELA FINAL (VIT√ìRIA)
        "vitoria": {
            text: "[11:30] Voc√™ vai pessoalmente ao QG. O Comandante da Defesa Civil entende a gravidade.\n\nPLANO CONJUNTO ATIVADO:\n1. Defesa Civil envia caminh√£o-pipa (Fim do risco Lepto).\n2. Defesa Civil abre anexo do gin√°sio (Fim do risco Respirat√≥rio).\n3. M√©dicos aplicam profilaxia e isolamento.\n\nCrise Gerenciada.",
            feedback: { type: "success", msg: "MISS√ÉO CUMPRIDA: Voc√™ resolveu o desafio do Grupo 5." },
            choices: [
                { text: "Reiniciar Apresenta√ß√£o", target: "start" }
            ]
        }
    };

    const textElement = document.getElementById('story-text');
    const choicesContainer = document.getElementById('choices-container');
    const feedbackArea = document.getElementById('feedback-area');
    
    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            textElement.innerHTML = text.substring(0, i+1) + '<span class="cursor"></span>';
            setTimeout(function() {
                typeWriter(text, i + 1, fnCallback)
            }, 15);
        } else {
            if (fnCallback) fnCallback();
        }
    }

    function goTo(sceneId) {
        const scene = story[sceneId];
        textElement.innerHTML = "";
        choicesContainer.innerHTML = "";
        choicesContainer.style.opacity = "0";
        feedbackArea.style.display = "none";

        if (scene.feedback) {
            feedbackArea.style.display = "block";
            feedbackArea.className = scene.feedback.type === 'success' ? 'feedback-success' : 'feedback-error';
            const icon = scene.feedback.type === 'success' ? 'üë®‚Äç‚öïÔ∏èüëç' : 'üë®‚Äç‚öïÔ∏èüëé';
            feedbackArea.innerText = icon + " " + scene.feedback.msg;
        }

        typeWriter(scene.text, 0, function() {
            renderButtons(scene.choices);
        });
    }

    function renderButtons(choices) {
        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text;
            btn.className = 'btn';
            btn.onclick = function() {
                goTo(choice.target);
            };
            choicesContainer.appendChild(btn);
        });
        setTimeout(() => {
            choicesContainer.style.opacity = "1";
        }, 100);
    }
</script>
</body>
</html>
