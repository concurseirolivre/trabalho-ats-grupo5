<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o ATS - Grupo 5</title>
    <style>
        /* --- GERAL --- */
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* FUNDOS */
        .background-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -5;
            transition: all 1s ease;
        }
        
        .bg-prologue {
            filter: brightness(0.4) contrast(1.1);
            transition: background-image 0.5s ease;
        }
        
        .bg-game {
            background-image: url('img1.jpg'); 
            filter: brightness(0.3) contrast(1.2) blur(2px);
        }

        /* EFEITOS VISUAIS */
        #disaster-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 900;
            display: none;
        }

        .rain {
            position: absolute;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.5));
            width: 2px;
            height: 50px;
            top: -60px;
            border-radius: 2px;
            pointer-events: none;
        }

        .fire-particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255,80,0,0.8) 0%, rgba(255,0,0,0) 70%);
            border-radius: 50%;
            bottom: -50px;
            pointer-events: none;
            filter: blur(4px);
            mix-blend-mode: screen;
        }

        .shake-screen {
            animation: shake 3s cubic-bezier(.36,.07,.19,.97) infinite;
        }

        @keyframes rain-fall { to { transform: translateY(120vh); } }
        @keyframes rise { 
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-80vh) scale(0); opacity: 0; }
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(1px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }

        /* --- 1. TELA DE PR√ìLOGO --- */
        #prologue-container {
            width: 90%;
            max-width: 900px;
            background-color: rgba(20, 20, 25, 0.95);
            border: 1px solid #444;
            border-top: 5px solid #2196F3;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            z-index: 1000;
            animation: fadeIn 1s;
            position: relative;
        }

        #prologue-title {
            color: #2196F3;
            font-size: 1.5em;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            width: 100%;
        }

        #prologue-text {
            font-size: 1.3em;
            line-height: 1.6;
            min-height: 200px;
            white-space: pre-wrap;
            margin-bottom: 30px;
            text-align: left;
            color: #fff;
        }

        .nav-buttons {
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: space-between;
            align-items: center;
        }

        .btn-prologue {
            background: transparent;
            border: 1px solid #2196F3;
            color: #2196F3;
            padding: 10px 30px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }
        .btn-prologue:hover { background: #2196F3; color: white; }

        /* --- 2. TELA DE ABERTURA/ALERTA --- */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none; /* Come√ßa oculta */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            opacity: 0;
        }

        #intro-content h1 {
            color: #ff3d00;
            font-size: 4em;
            margin-bottom: 0;
            text-transform: uppercase;
            text-shadow: 0 0 20px rgba(255, 61, 0, 0.8);
            animation: pulse 1.5s infinite;
            letter-spacing: 5px;
        }

        #intro-content h2 {
            color: #fff;
            font-weight: normal;
            margin-top: 10px;
            font-size: 1.5em;
        }

        #btn-start-simulation {
            background: transparent;
            border: 3px solid #ff3d00;
            color: #ff3d00;
            padding: 20px 50px;
            font-size: 1.8em;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            margin-top: 50px;
            transition: all 0.3s;
            text-transform: uppercase;
            animation: borderPulse 2s infinite;
        }
        #btn-start-simulation:hover {
            background-color: #ff3d00;
            color: #000;
            box-shadow: 0 0 30px #ff3d00;
        }

        /* --- 3. TELA DO JOGO --- */
        #game-container {
            width: 80%;
            max-width: 800px;
            background-color: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-left: 5px solid #d32f2f;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            min-height: 400px;
            display: none;
            flex-direction: column;
            opacity: 0;
            z-index: 500;
        }

        .header {
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #888;
        }
        .status-blink { color: #d32f2f; font-weight: bold; animation: blink 1s infinite; }
        
        #story-text { font-size: 1.2em; line-height: 1.6; white-space: pre-wrap; min-height: 100px; }

        #feedback-area { 
            margin-bottom: 20px; 
            font-weight: bold; 
            padding: 15px; 
            border-radius: 4px; 
            display: none; 
            font-size: 1.1em;
        }
        .feedback-success { background-color: rgba(46, 125, 50, 0.2); border: 1px solid #2e7d32; color: #81c784; }
        .feedback-error { background-color: rgba(198, 40, 40, 0.2); border: 1px solid #c62828; color: #e57373; }

        .choices { display: flex; flex-direction: column; gap: 10px; margin-top: 30px; opacity: 0; transition: opacity 1s; }
        
        .btn { 
            background: transparent; 
            border: 1px dashed #FFEB3B; 
            color: #FFEB3B; 
            padding: 15px; 
            text-align: left; 
            font-family: inherit; 
            font-size: 1.1em; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        .btn:hover { 
            background-color: #FFEB3B; 
            color: #000; 
            border-style: solid; 
            transform: translateX(5px); 
        }
        
        .cursor { display: inline-block; width: 10px; height: 1em; background-color: #0f0; animation: blink 1s infinite; vertical-align: bottom; }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes borderPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 61, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 61, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 61, 0, 0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="background-fixed bg-prologue" id="main-bg"></div>
    
    <div id="disaster-layer"></div>

    <audio id="audio-prologue" preload="auto"></audio>
    <audio id="audio-news" src="noticia.mp3" preload="auto"></audio>
    <audio id="audio-game" src="audio.mp3" preload="auto"></audio>

    <div id="prologue-container">
        <div id="prologue-title">INTRODU√á√ÉO T√âCNICA</div>
        <div id="prologue-text"></div>
        
        <div class="nav-buttons">
            <button class="btn-prologue" id="btn-prev-prologue" style="visibility: hidden;">Anterior</button>
            
            <!-- Bot√£o de narra√ß√£o (context-aware) -->
            <button class="btn-prologue" id="btn-play-pause" style="min-width: 160px;">‚èØÔ∏è Play</button>

            <button class="btn-prologue" id="btn-next-prologue">Pr√≥ximo ‚ûú</button>
        </div>
    </div>

    <div id="intro-screen">
        <div id="intro-content">
            <h1>ATEN√á√ÉO</h1>
            <h2>SITUA√á√ÉO DE DESASTRE EM ANDAMENTO</h2>
            <h2>A√á√ÉO IMEDIATA NECESS√ÅRIA</h2>
            
            <button id="btn-start-simulation">INICIAR OPERA√á√ÉO</button>
        </div>
    </div>

    <div id="game-container">
        <div class="header">
            <span>SALA DE SITUA√á√ÉO: GRUPO 5</span>
            <span class="status-blink">‚óè AO VIVO - PETR√ìPOLIS</span>
        </div>

        <div id="feedback-area"></div>

        <div id="text-container">
            <span id="story-text"></span><span class="cursor"></span>
        </div>
        
        <div id="choices-container" class="choices"></div>
    </div>

<script>
    // --- REFER√äNCIAS GERAIS ---
    const prologueContainer = document.getElementById('prologue-container');
    const introScreen = document.getElementById('intro-screen');
    const gameContainer = document.getElementById('game-container');
    const mainBg = document.getElementById('main-bg');
    const disasterLayer = document.getElementById('disaster-layer');
    
    // Players de √Åudio
    const audioPrologue = document.getElementById('audio-prologue');
    const audioNews = document.getElementById('audio-news');
    const audioGame = document.getElementById('audio-game');
    
    // Bot√µes
    const btnPlayPause = document.getElementById('btn-play-pause');
    const btnNext = document.getElementById('btn-next-prologue');
    const btnPrev = document.getElementById('btn-prev-prologue');
    const btnStartSim = document.getElementById('btn-start-simulation');

    // --- VARI√ÅVEIS DE CONTROLE ---
    let currentPrologueIndex = 0;
    let isFirstInteraction = true;
    let disasterInterval;
    let currentStage = 'prologue'; // 'prologue' | 'intro' | 'game'

    // --- DADOS DO PR√ìLOGO ---
    const prologueData = [
        {
            title: "IN√çCIO",
            text: "\"Quando um desastre acontece ‚Äî seja um deslizamento, um inc√™ndio ou uma enchente ‚Äî o caos domina os primeiros minutos.\n\nMas existe uma l√≥gica m√©dica por tr√°s das decis√µes que salvam vidas. Hoje voc√™ vai entender como funciona a atua√ß√£o do m√©dico em cen√°rios de desastre.\"",
            img: "https://www.pragmatismopolitico.com.br/wp-content/uploads/2018/05/acidente-cuba-e1527030296940.jpg",
            audio: "audio1.mp3",
            effectType: 'rain'
        },
        {
            title: "O PAPEL DO M√âDICO",
            text: "\"Um desastre √© qualquer evento que ultrapassa a capacidade normal de resposta.\n\nO m√©dico precisa entender fisiologia, toxicologia e epidemiologia. √â aqui que entram conceitos como triagem, manejo de vias a√©reas e tomada de decis√£o r√°pida quando n√£o h√° recursos para todos.\"",
            img: "https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?auto=format&fit=crop&w=1920&q=80",
            audio: "audio2.mp3"
        },
        {
            title: "TRIAGEM (M√âTODO START)",
            text: "\"A triagem √© o cora√ß√£o da resposta m√©dica. √â nela que o m√©dico define quem precisa de interven√ß√£o imediata.\n\nO m√©todo START baseia-se em:\n‚Ä¢ Respira√ß√£o (>30rpm = Vermelho)\n‚Ä¢ Perfus√£o (>2s = Choque)\n‚Ä¢ Estado mental (N√£o obedece comandos = Hip√≥xia)\"",
            img: "https://images.unsplash.com/photo-1516574187841-69301976e49e?auto=format&fit=crop&w=1920&q=80",
            audio: "audio3.mp3"
        },
        {
            title: "SITUA√á√ïES SIMPLES",
            text: "\"A maioria das demandas s√£o simples: ferimentos leves, ansiedade, desidrata√ß√£o.\n\nO m√©dico atua como estabilizador: hidrata√ß√£o oral, suturas, analg√©sicos e controle de hipertens√£o por estresse em vulner√°veis.\"",
            img: "https://www.saude.sp.gov.br/resources/hospital-leonor-mendes-de-barros/acesso-rapido/primeiros-socorros-em-caso-de-incendio.jpg",
            audio: "audio4.mp3"
        },
        {
            title: "ALTA COMPLEXIDADE",
            text: "\"Em inc√™ndios: Intoxica√ß√£o por mon√≥xido de carbono.\nEm deslizamentos: S√≠ndrome do Esmagamento (libera√ß√£o de mioglobina e pot√°ssio, risco renal e arritmias).\n\nDecis√µes baseadas em fisiologia e protocolos.\"",
            img: "https://ogimg.infoglobo.com.br/in/23946251-8e9-d10/FT1086A/GettyImages-56441651.jpg",
            audio: "audio5.mp3",
            effectType: 'fire'
        },
        {
            title: "LOG√çSTICA E LIDERAN√áA",
            text: "\"O m√©dico coordena fluxos e conversa com bombeiros e defesa civil.\n\nNo abrigo, o trabalho continua: vigil√¢ncia epidemiol√≥gica, preven√ß√£o de surtos, vacina√ß√£o e controle da √°gua.\"",
            img: "https://cdn.folhape.com.br/img/c/1200/900/dn_arquivo/2020/01/medico1.jpg",
            audio: "audio6.mp3"
        },
        {
            title: "A ESS√äNCIA",
            text: "\"No fim, atuar em um desastre √© equilibrar ci√™ncia, humanidade e estrat√©gia.\n\nA medicina nesses cen√°rios n√£o √© apenas t√©cnica; exige tamb√©m coragem e organiza√ß√£o quando tudo ao redor parece destru√≠do.\"",
            img: "https://blog.unyleyamed.com.br/wp-content/uploads/2023/09/shutterstock_661890763-scaled.webp",
            audio: "audio7.mp3"
        }
    ];

    // --- FUN√á√ïES DE EFEITO VISUAL ---
    function startDisasterEffect(type) {
        disasterLayer.style.display = 'block';
        disasterLayer.innerHTML = ''; 
        clearInterval(disasterInterval);

        if (type === 'rain') {
            prologueContainer.classList.add('shake-screen');
            disasterInterval = setInterval(() => {
                for(let i=0; i<4; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain';
                    drop.style.left = Math.random() * 100 + 'vw';
                    drop.style.height = (Math.random() * 20 + 30) + 'px';
                    const speed = Math.random() * 0.3 + 0.5; 
                    drop.style.animation = `rain-fall ${speed}s linear`;
                    disasterLayer.appendChild(drop);
                    setTimeout(() => { drop.remove(); }, speed * 1000);
                }
            }, 50);
        } else if (type === 'fire') {
            prologueContainer.classList.remove('shake-screen');
            disasterInterval = setInterval(() => {
                for(let i=0; i<3; i++) {
                    const ember = document.createElement('div');
                    ember.className = 'fire-particle';
                    ember.style.left = Math.random() * 100 + 'vw';
                    ember.style.width = (Math.random() * 20 + 5) + 'px';
                    ember.style.height = ember.style.width;
                    const color = Math.random() > 0.5 ? 'rgba(255,80,0,0.8)' : 'rgba(255,200,0,0.6)';
                    ember.style.background = `radial-gradient(circle, ${color} 0%, rgba(255,0,0,0) 70%)`;
                    const speed = Math.random() * 1.5 + 1; 
                    ember.style.animation = `rise ${speed}s ease-out forwards`;
                    disasterLayer.appendChild(ember);
                    setTimeout(() => { ember.remove(); }, speed * 1000);
                }
            }, 80);
        }
    }

    function stopDisasterEffect() {
        clearInterval(disasterInterval);
        disasterLayer.innerHTML = '';
        disasterLayer.style.display = 'none';
        prologueContainer.classList.remove('shake-screen');
    }

    // --- FUN√á√ïES DE √ÅUDIO (PR√ìLOGO / GAME) ---
    function loadAndPlayAudioPrologue(sourceUrl) {
        audioPrologue.src = sourceUrl;
        audioPrologue.load();
        // se o usu√°rio j√° interagiu, toca
        if (!isFirstInteraction) {
            audioPrologue.play().then(() => {
                updatePlayButtonUI(true);
            }).catch(e => {
                console.log("Autoplay prologue bloqueado:", e);
                updatePlayButtonUI(false);
            });
        } else {
            updatePlayButtonUI(false);
        }
    }

    // Atualiza texto do bot√£o dependendo do est√°gio e do estado do √°udio associado
    function updatePlayButtonUI(isPlaying) {
        if (currentStage === 'prologue') {
            btnPlayPause.innerText = isPlaying ? "‚è∏Ô∏è Pausar (Pr√≥logo)" : "‚ñ∂Ô∏è Tocar Narra√ß√£o (Pr√≥logo)";
        } else if (currentStage === 'intro' || currentStage === 'game') {
            btnPlayPause.innerText = isPlaying ? "‚è∏Ô∏è Pausar (Narra√ß√£o)" : "‚ñ∂Ô∏è Reproduzir (Narra√ß√£o)";
        } else {
            btnPlayPause.innerText = "‚èØÔ∏è Play";
        }
    }

    // Helper para tocar audioGame com checagem
    function playAudioGameIfPossible() {
        audioGame.currentTime = 0;
        return audioGame.play().then(() => {
            updatePlayButtonUI(true);
        }).catch(e => {
            console.error("Erro ao tentar tocar audioGame:", e);
            updatePlayButtonUI(false);
        });
    }

    // --- ATUALIZA√á√ÉO DO PR√ìLOGO ---
    function updatePrologue() {
        currentStage = 'prologue';
        const data = prologueData[currentPrologueIndex];
        document.getElementById('prologue-title').innerText = data.title;
        document.getElementById('prologue-text').innerText = data.text;
        mainBg.style.backgroundImage = `url('${data.img}')`;

        // Efeitos
        if (data.effectType) {
            startDisasterEffect(data.effectType);
        } else {
            stopDisasterEffect();
        }

        // Visibilidade Bot√µes Nav
        btnPrev.style.visibility = currentPrologueIndex === 0 ? 'hidden' : 'visible';
        
        if (currentPrologueIndex === prologueData.length - 1) {
            btnNext.innerText = "IR PARA A√á√ÉO ‚ö†";
            btnNext.style.borderColor = "#ff3d00";
            btnNext.style.color = "#ff3d00";
        } else {
            btnNext.innerText = "Pr√≥ximo ‚ûú";
            btnNext.style.borderColor = "#2196F3";
            btnNext.style.color = "#2196F3";
        }

        // Gerencia √Åudio do pr√≥logo
        if (data.audio) {
            loadAndPlayAudioPrologue(data.audio);
        } else {
            audioPrologue.pause();
            updatePlayButtonUI(false);
        }
    }

    // --- EVENT LISTENERS (CONTROLES) ---

    // Bot√£o Play/Pause (context-aware)
    btnPlayPause.addEventListener('click', () => {
        // Libera intera√ß√£o no primeiro clique
        if (isFirstInteraction) {
            isFirstInteraction = false;
        }

        if (currentStage === 'prologue') {
            // Controla o audioPrologue
            if (!audioPrologue.src) {
                // carrega atual
                const data = prologueData[currentPrologueIndex];
                if (data && data.audio) audioPrologue.src = data.audio;
            }
            if (audioPrologue.paused) {
                audioPrologue.play().then(() => updatePlayButtonUI(true)).catch(e => {
                    console.log("Erro play prologue:", e);
                    updatePlayButtonUI(false);
                });
            } else {
                audioPrologue.pause();
                updatePlayButtonUI(false);
            }
            return;
        }

        // Se n√£o estamos no pr√≥logo, controlamos audioGame (narracao principal)
        if (audioGame.paused) {
            audioGame.play().then(() => updatePlayButtonUI(true)).catch(e => {
                console.log("Erro play audioGame:", e);
                updatePlayButtonUI(false);
            });
        } else {
            audioGame.pause();
            updatePlayButtonUI(false);
        }
    });

    // Atualiza bot√£o quando √°udios mudam de estado
    audioPrologue.addEventListener('play', () => {
        if (currentStage === 'prologue') updatePlayButtonUI(true);
    });
    audioPrologue.addEventListener('pause', () => {
        if (currentStage === 'prologue') updatePlayButtonUI(false);
    });
    audioPrologue.addEventListener('ended', () => {
        if (currentStage === 'prologue') updatePlayButtonUI(false);
    });

    audioGame.addEventListener('play', () => {
        if (currentStage !== 'prologue') updatePlayButtonUI(true);
    });
    audioGame.addEventListener('pause', () => {
        if (currentStage !== 'prologue') updatePlayButtonUI(false);
    });
    audioGame.addEventListener('ended', () => {
        if (currentStage !== 'prologue') updatePlayButtonUI(false);
    });

    // Bot√£o Pr√≥ximo
    btnNext.addEventListener('click', () => {
        // Se for o primeiro clique da p√°gina, marca como interagido
        if(isFirstInteraction) {
            isFirstInteraction = false;
        }

        if (currentPrologueIndex < prologueData.length - 1) {
            currentPrologueIndex++;
            updatePrologue();
        } else {
            // FIM DO PR√ìLOGO -> VAI PARA TELA DE ALERTA
            stopDisasterEffect();
            audioPrologue.pause(); 

            // === AQUI: quando o usu√°rio clica em "IR PARA A√á√ÉO", tocamos audio.mp3 imediatamente ===
            currentStage = 'intro';
            // Tenta tocar audioGame (audio.mp3). n√£o usamos audioNews aqui por pedido do usu√°rio.
            audioGame.currentTime = 0;
            audioGame.play().then(() => {
                updatePlayButtonUI(true);
            }).catch(e => {
                // Se autoplay for bloqueado, apenas atualiza UI e mant√©m a tela
                console.warn("N√£o foi poss√≠vel iniciar audioGame automaticamente:", e);
                updatePlayButtonUI(false);
            });

            showIntroScreen();
        }
    });

    // Bot√£o Anterior
    btnPrev.addEventListener('click', () => {
        if (currentPrologueIndex > 0) {
            currentPrologueIndex--;
            updatePrologue();
        }
    });

    // --- TRANSI√á√ïES DE TELA ---
    function showIntroScreen() {
        prologueContainer.style.display = 'none';
        mainBg.style.backgroundImage = "url('img1.jpg')";
        mainBg.className = "background-fixed bg-game"; 

        introScreen.style.display = 'flex';
        setTimeout(() => {
            introScreen.style.opacity = '1';
        }, 50);
    }

    // Bot√£o "Iniciar Opera√ß√£o" (Tela de Alerta -> Jogo)
    btnStartSim.addEventListener('click', () => {
        // Troca de est√°gio
        currentStage = 'game';

        // N√£o pausa audioGame ‚Äî se estiver tocando, mantemos
        if (audioGame.paused) {
            // tenta continuar tocando (isso s√≥ ocorrer√° se autoplay foi bloqueado antes)
            audioGame.currentTime = 0;
            audioGame.play().then(() => updatePlayButtonUI(true)).catch(e => {
                console.error("Audio game error ao iniciar opera√ß√£o:", e);
                updatePlayButtonUI(false);
            });
        } else {
            updatePlayButtonUI(true);
        }

        introScreen.style.transition = "opacity 1s";
        introScreen.style.opacity = '0';

        setTimeout(() => {
            introScreen.style.display = 'none';
            gameContainer.style.display = 'flex';
            
            setTimeout(() => {
                gameContainer.style.opacity = '1';
                gameContainer.style.animation = 'fadeIn 1s ease-out';
                goTo('start');
            }, 100);
        }, 1000);
    });

    // --- MOTOR DO JOGO (TEXTO E DECIS√ïES) ---
    const story = {
        "start": {
            text: "[06:05] CONEX√ÉO ESTABELECIDA COM POSTO DE COMANDO...\n\nO deslizamento acabou de acontecer. A rep√≥rter confirmou o caos local. Voc√™ √© o Coordenador M√©dico.\n\nRecursos limitados. Vidas em risco.\n\nSua primeira decis√£o definir√° toda a opera√ß√£o. Qual sua prioridade?",
            choices: [
                { text: "A - Ir pessoalmente para a Zona de Impacto (Triagem)", target: "erro_gestao" },
                { text: "B - Focar na Gest√£o (Posto de Comando)", target: "fase_2" }
            ]
        },
        "erro_gestao": {
            text: "Voc√™ chega √† Zona de Impacto e ajuda na triagem. Por√©m, voc√™ ficou incomunic√°vel por 8 horas.\n\nNingu√©m coordenou os abrigos. O caos se instalou.",
            feedback: { type: "error", msg: "ERRO DE GEST√ÉO: Ao focar na emerg√™ncia (micro), voc√™ abdicou da gest√£o (macro)." },
            choices: [
                { text: "Reiniciar Simula√ß√£o", target: "start" }
            ]
        },
        "fase_2": {
            text: "Decis√£o correta. Do Posto de Comando, voc√™ recebe o balan√ßo:\n- 10 equipes m√©dicas dispon√≠veis.\n- Emerg√™ncia: M√∫ltiplos feridos na lama.\n- Preven√ß√£o: 200 desalojados em abrigos prec√°rios.\n\nComo voc√™ aloca sua equipe?",
            feedback: { type: "success", msg: "ACERTO: O papel do coordenador √© gerenciar recursos." },
            choices: [
                { text: "A - 100% das equipes para a Zona de Impacto (Foco nos feridos)", target: "erro_prevencao" },
                { text: "B - 70% Emerg√™ncia / 30% Avalia√ß√£o dos Abrigos", target: "fase_3" }
            ]
        },
        "retry_fase_2": {
            text: "[07:00] Voltando √† decis√£o de aloca√ß√£o...\n\nTemos 10 equipes, muitos feridos na lama e 200 desalojados em abrigos.\n\nComo voc√™ aloca a equipe?",
            choices: [
                { text: "A - 100% das equipes para a Zona de Impacto", target: "erro_prevencao" },
                { text: "B - 70% Emerg√™ncia / 30% Avalia√ß√£o dos Abrigos", target: "fase_3" }
            ]
        },
        "erro_prevencao": {
            text: "[18:00] 12 horas se passam. O atendimento aos feridos foi √≥timo, mas um surto de v√¥mito e diarreia explodiu nos abrigos (Hepatite A/C√≥lera).",
            feedback: { type: "error", msg: "FALHA NA PREVEN√á√ÉO: Voc√™ ignorou os abrigos e criou uma segunda crise." },
            choices: [
                { text: "Tentar Novamente", target: "retry_fase_2" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },
        "fase_3": {
            text: "[10:00] A equipe de avalia√ß√£o (30%) retorna com ALERTA VERMELHO:\n\n1. Abrigo Escola: √Ågua parada e lama (Risco Leptospirose).\n2. Abrigo Gin√°sio: Superlota√ß√£o e tosse (Risco Respirat√≥rio).\n\nQual sua prioridade de Sa√∫de P√∫blica?",
            feedback: { type: "success", msg: "ACERTO: Dividir a equipe permitiu detectar os riscos a tempo." },
            choices: [
                { text: "A - Atacar a Leptospirose (Profilaxia)", target: "erro_clinico" },
                { text: "B - Atacar o Surto Respirat√≥rio (M√°scaras)", target: "erro_clinico" },
                { text: "C - Atacar a Causa Raiz (Articula√ß√£o Intersetorial)", target: "fase_4" }
            ]
        },
        "retry_fase_3": {
            text: "[10:00] Reavaliando a estrat√©gia sanit√°ria...\n\nTemos risco de Leptospirose (√°gua parada) e Respirat√≥rio (superlota√ß√£o).\n\nQual sua prioridade?",
            choices: [
                { text: "A - Atacar a Leptospirose (Profilaxia)", target: "erro_clinico" },
                { text: "B - Atacar o Surto Respirat√≥rio (M√°scaras)", target: "erro_clinico" },
                { text: "C - Atacar a Causa Raiz (Articula√ß√£o Intersetorial)", target: "fase_4" }
            ]
        },
        "erro_clinico": {
            text: "Voc√™ envia insumos m√©dicos. Mas a lama continua l√° e a superlota√ß√£o tamb√©m.\n\nVoc√™ est√° enxugando gelo tratando apenas o sintoma.",
            feedback: { type: "error", msg: "ERRO DE VIS√ÉO: Sem resolver a infraestrutura (Causa Raiz), o rem√©dio n√£o resolve." },
            choices: [
                { text: "Tentar Novamente", target: "retry_fase_3" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },
        "fase_4": {
            text: "[11:00] Voc√™ tenta contatar a Defesa Civil para pedir √°gua pot√°vel e espa√ßo.\n\nO r√°dio est√° mudo. \"Dificuldades de comunica√ß√£o\", como previsto no cen√°rio.\n\nO que voc√™ faz?",
            feedback: { type: "success", msg: "ACERTO: Voc√™ identificou que o problema √© infraestrutura, n√£o apenas rem√©dio." },
            choices: [
                { text: "A - Continuar tentando pelos canais oficiais (Protocolo)", target: "erro_burocracia" },
                { text: "B - Ir fisicamente ao QG da Defesa Civil (Pr√≥-atividade)", target: "vitoria" }
            ]
        },
        "retry_fase_4": {
            text: "[11:00] O r√°dio continua mudo e a Defesa Civil n√£o responde seus chamados.\n\nO tempo est√° correndo.\n\nO que voc√™ faz?",
            choices: [
                { text: "A - Insistir nos canais oficiais (Protocolo)", target: "erro_burocracia" },
                { text: "B - Ir fisicamente ao QG da Defesa Civil", target: "vitoria" }
            ]
        },
        "erro_burocracia": {
            text: "Voc√™ perde 3 horas tentando usar o r√°dio. Ningu√©m responde. A janela de oportunidade se fecha e os primeiros casos de febre aparecem.",
            feedback: { type: "error", msg: "FALHA DE ARTICULA√á√ÉO: Em desastres, a burocracia colapsa. Esperar √© fatal." },
            choices: [
                { text: "Tentar Novamente", target: "retry_fase_4" },
                { text: "Reiniciar do Zero", target: "start" }
            ]
        },
        "vitoria": {
            text: "[11:30] Voc√™ vai pessoalmente ao QG. O Comandante da Defesa Civil entende a gravidade.\n\nPLANO CONJUNTO ATIVADO:\n1. Defesa Civil envia caminh√£o-pipa (Fim do risco Lepto).\n2. Defesa Civil abre anexo do gin√°sio (Fim do risco Respirat√≥rio).\n3. M√©dicos aplicam profilaxia e isolamento.\n\nCrise Gerenciada.",
            feedback: { type: "success", msg: "MISS√ÉO CUMPRIDA: Voc√™ resolveu o desafio do Grupo 5." },
            choices: [
                { text: "Reiniciar Apresenta√ß√£o", target: "start" }
            ]
        }
    };

    const textElement = document.getElementById('story-text');
    const choicesContainer = document.getElementById('choices-container');
    const feedbackArea = document.getElementById('feedback-area');
    
    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            textElement.innerHTML = text.substring(0, i+1) + '<span class="cursor"></span>';
            setTimeout(function() {
                typeWriter(text, i + 1, fnCallback)
            }, 15);
        } else {
            if (fnCallback) fnCallback();
        }
    }

    function goTo(sceneId) {
        const scene = story[sceneId];
        textElement.innerHTML = "";
        choicesContainer.innerHTML = "";
        choicesContainer.style.opacity = "0";
        feedbackArea.style.display = "none";

        if (scene.feedback) {
            feedbackArea.style.display = "block";
            feedbackArea.className = scene.feedback.type === 'success' ? 'feedback-success' : 'feedback-error';
            const icon = scene.feedback.type === 'success' ? 'üë®‚Äç‚öïÔ∏èüëç' : 'üë®‚Äç‚öïÔ∏èüëé';
            feedbackArea.innerText = icon + " " + scene.feedback.msg;
        }

        typeWriter(scene.text, 0, function() {
            renderButtons(scene.choices);
        });
    }

    function renderButtons(choices) {
        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text;
            btn.className = 'btn';
            btn.onclick = function() {
                goTo(choice.target);
            };
            choicesContainer.appendChild(btn);
        });
        setTimeout(() => {
            choicesContainer.style.opacity = "1";
        }, 100);
    }

    // Inicializar o primeiro slide, mas com √°udio pausado
    updatePrologue();
</script>
</body>
</html>
